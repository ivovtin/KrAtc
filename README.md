--------------------------------------------------------------------------------------------------------  <br />
Название: KrAtc                                                                                            <br />
Авторы: И.В. Овтин, С.А. Кононов, А.Р. Бузыкаев                                                            <br />
Поддержка: И.В. Овтин, т. 46-35, I.V.Ovtin@inp.nsk.su, С.А. Кононов, т. 49-34, mailto:S.A.Kononov@inp.nsk.su  <br />
Описание: реконструкция аэрогелевых черенковских счетчиков детектора КЕДР                                     <br />
--------------------------------------------------------------------------------------------------------      <br />
                                                                                                              <br />
---------------------------                                                                                   <br />
Основы работы с пакетом                                                                                       <br />
---------------------------                                                                                   <br />
Пакет предназначен для реконструкции хитов в аэрогелевых черенковских счетчиках и получения информации о типе частицы (PID).   <br />
Пакет используется также для обработки калибровок АЧС.                                                                         <br />

Интерфейс для C++/C состоит из вызовов (atcrec.h):   <br />
 int atc_init();          //Инициализация реконструкции  <br />
 int atc_run(int run);    //Инициализация для захода run  <br />
 int atc_event();         //Реконструкция одного события  <br />
 void atc_stop();         //Освобождение используемой памяти по окончании работы  <br />
Данные реконструкции хранятся в структурах:  <br />
atcrec.h:  <br />
 atc_track - привязка VDDC треков к счетчикам     <br />
 atc_rec   - восстановленные амплитуды и времена хитов  <br />
 atc_data  - используемые калибровочные константы       <br />
atc_geometry.h:                                         <br />
 atc_geom  - информация о положении счетчиков           <br />

Интерфейс для Фортрана состоит из одноименных подпрограм и common-блоков (atcrec.inc).  <br />
Примечание: номер захода для atc_run должен передаваться по значению:                   <br />
 call atc_run(%val(run))                                                                <br />

----------------------- <br />
Зависимости пакета       <br />
-----------------------  <br />
Пакет зависит от следующих кедровских пакетов: VDDCRec ReadNat AppFramework     <br />
Должны подключаться следующие внешние библиотеки: `root-config --libs` -lMinuit  <br />

Предусмотрена сборка упрощенной версии библиотеки без подключения внешних библиотек.  <br />
Для этого библиотеку надо собирать командой:                                          <br />
make -f Makefile-reduced                                                              <br />
И при сборке своей программы библиотеки ROOTа можно опустить, если только они не требуются программой или другими пакетами.  <br />
Упрощенная версия библиотеки собирается в stable наряду с полной и хранится в libKrAtc-reduced.a. При сборке программы с упрощенной версией из stable в Makefile нужно заменить KrAtc на KrAtc-reduced.  <br />

----------------------   <br />
Подробное описание       <br />
----------------------    <br />
Реконструкция события происходит в три этапа: <br />
1) восстановление амплитуд и времен сработавших счетчиков в прочитанном пакетом ReadNat событии   <br />
2) определение для каждого трека восстановленного в VDDCRec координат пересечений с аэрогелевыми счетчиками   <br />
3) получение вероятности разных гипотез для каждой частицы (пока не реализовано)  <br />

Файлы пакета:  <br />
AtcRec.{hh,cc}    Класс AtcRec наследуемый от базового класса AppModule.
                  AtcRec получает событие от ReadNat и реконструирует амплитуду, время
                  и другие параметры для каждого счетчика, хотя бы одна точка
                  которого прочитана в данном событии.
                  Прочитанные амплитуды и реконструированные параметры хранятся
                  в объектах AtcHit, доступ к которым осуществляется через
		  контейнер типа AtcHits. После обработки каждого события
                  в универсальный контейнер AppEvent кладется объект AtcHits
                  под именем "AtcHits".         <br />

AtcPar.{hh,cc}    Класс AtcCntPar, который по сути является хранилищем
		  начальных значений параметров для подгонки и
		  одноэлектронной амплитуды счетчика. atcPar - глобальная
		  структура, задающая конфигурацию реконструкции, содержит
		  массив объектов AtcCntPar для каждого счетчика и
		  константы платы DeltaT. Заполняется значениями
                  по умолчанию в начале обработки, затем в начале каждого
		  захода заполняется параметрами, полученными из базы данных.   <br />

AtcHit.{hh,cc}    Класс AtcHit и контейнер хитов - AtcHits.
		  AtcHit содержит до 5 точек, оцифрованных платой A6,
                  восстановленные параметры подгонки, тип события,
                  положение пика.
                  AtcHit сам отвечает за восстановление амплитуды в числе ф.э.
		  и времен на основе прочитанных амплитуд, данных DeltaT и
		  заданной одноэлектронной амплитуды. Восстановление выполняется
		  методом rec(). Имеется возможность рисования хита
		  (точки A6, форма восстановленного импульса) методом draw().
                  Класс AtcHits - есть hash_map содержащий объекты AtcHit
                  для всех счетчиков, содержащихся в текущем событии.
                  Кроме того AtcHits содержит информацию с платы DeltaT и
		  флаг качества "события" ev_type с точки зрения ATC.           <br />

AtcVFitter.hh     Описание абстрактного базового класса, который подгоняет
                  амплитуду и время хита AtcHit.                                <br />
AtcMinuitFitter.{hh,cc}
                  Реализация класса подгонки с использованием TMinuit из ROOTа.   <br />
AtcLeamaxFitter.{hh,cc}
                  Реализация класса подгонки с использованием пакета LEAMAX
                  из CERNLIB. Для сборки с ним требуется скомпилировать пакет KrAtc с
                  переменной LEAMAX_FITTER. При сборке программ требуется подключить
                  вместо Minuit церновские библиотеки: mathlib lapack3 blas       <br />

atcrec.{h,cc}     Интрефейс вызова реконструкции АЧС. Поддерживаются C++/C/Fortran.
                  30.01.2017 добавлен интерфейс вызова/чтения данных моделирования.
                  Заполняются структуры числа ф.э. и номера сработавших счетчиков из
                  файла моделирования.                                            <br />

atcrec.inc        Описание common-блоков для работы с реконструкцией в Фортране.  <br />

DCTrackExt.{h,cc} Для нахождения пересечений трека восстановленного в VDDCRec с простыми
                  типами поверхностей.                                            <br />

atc_geometry.{h,cc}
                  Задание геометрии счетчиков АШИФ                                <br />

atc_regions.{h,cc}
                  Нахождение попадания в определенные области счетчика с разными отступами
		  от стенок (Aerogel, Active, CRT)                                <br />

atc_to_track.{h.cc}
                  Заполнение структуры atctrackinfo на трек (трек, число пересеченных счетчиков,
		  список счетчиков, Nph.e. ... ).                                 <br />

atc_sim.h         Определение структуры для заполнения сырыми данными из моделирования     <br />

atc_amp_coef.F    Вычисление среднего числа ф.э. в Черенковсом счетчике.
                  Учитывается неоднородность светосбора и долговременная стабильность.     <br />

get_atccalib_range.cc
                  Загрузка калибровочных коэффициентов для заданного номера захода
                  в моделировании. Вызывается в atc_amp_coef.F                             <br />

atc_hist.F        Вычисление амплитудного распределения для целого числа ф.э. Npe = 1,2,3,..
                  Чтение гистограммы с однофотоэлектронным спектром и заполнение матрицы SPEC       <br />

atc_read_1phe.cc  Получение однофотоэлектронного калибровочного спектра АЧС из root-файла
                  для необходимого моделируемого временного периода. Вызывается в atc_hist.F        <br />

atc_specn.F       Подпрограмма делает преобразование матриц cont и cont1 в cont2 - выходная матрица.
                  Вызывается в atc_hist.F                                                           <br />

atc_amp1.F        Подпрограмма генерирует реальную амплитуду из счетчика АЧС. Другие подпрограммы
                  вызываются в этом модуле: ATC_HIST, ATC_SPECN                                     <br />

Makefile          Файл сборки библиотеки пакета и тестовых программ.
                  На основе makefile поддерживаемого Балдиным Е. (пакет KcReleaseTools).            <br />

cntpar.atc        Конфигурационный файл реконструкции. Определяет для
                  каждого счетчика: логический номер платы и номер канала,
                  значения по умолчанию фиксированных параметров и их ошибки. (не обязателен)       <br />

offcnt.atc        Список нерабочих счетчиков не используемых в обработке. (не обязателен)           <br />

examples/test_atcrec.cc
                  Тестовая программа C++ только для восстановления хитов
                  использующая AppFramework                                                         <br />
examples/test_atcrecF.f
                  Тестовая программа на Фортране вызывающая реконструкцию VDDCRec
                  и KrAtc.                                                                          <br />

