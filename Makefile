# -*- mode: Makefile; -*- установка Makefile моды для Emacs
#--------------------------------------------------------------------------
#      $Id: Makefile,v 1.17 2019/06/25 06:49:08 ovtin Exp $
#
# Description:
#      Makefile for KcTemplate package
#
# Environment:
#      Software developed for the KEDR Detector at BINP.
#
# Author:
#      Baldin Evgueni Mihilovich (E.M.Baldin@inp.nsk.su)
#      Kononov Sergey (S.A.Kononov@inp.nsk.su)
# Copyright Information:
#      Copyright (C) 2000-2004  Budker's Institute of Nuclear Physics
#
#--------------------------------------------------------------------------
# следующие 3 строки лучше не трогать
ifeq (,$(WORKDIR))
WORKDIR = $(shell pushd ../ 1>/dev/null && pwd )
endif

# Всё что делается делается вслух :) - желательно оставить как есть
VERBOSEMAKE=""
# Если ключик -g при сборки не нужен - если уверен в себе
#NDEBUG=""

# Компилятор для *.с файлов
#CC_LOCAL := gcc
# Компилятор для *.cc и *.cpp файлов
#CXX_LOCAL := g++
# Компилятор для *.f, *.for и *.F файлов
F77_LOCAL := g77
# Линкер для этого пакета по умолчанию
#LD_LOCAL := g++
# Раскомментировать, если необходимо задавать линкер для каждого
# бинарника в отдельности. Обычно не требуется.
#LD_MULTI := ""

# Дополнительные опции для компилятора C/C++
COPTS  = `root-config --cflags` #-ansi -pedantic

#ATC reconstruction customization
ifdef ATC_NOFIT
COPTS += -DATC_NOFIT=1
endif
ifdef ATC_NOROOT
COPTS += -DATC_NOROOT=1
endif

# Дополнительные опции для компилятора Fortran
FOPTS  = -g -fvxt -Wall -fno-automatic -finit-local-zero \
-fno-second-underscore -ffixed-line-length-120 -Wno-globals \
-DCERNLIB_LINUX -DCERNLIB_UNIX -DCERNLIB_LNX -DCERNLIB_QMGLIBC -DCERNLIB_BLDLIB \
-DCOMPDATE="'$(COMPDATE)'" -I$(CERN)/pro/include -I$(CERN)/pro/include/geant321

# Отключение оптимизации - почему-то важно для моделирования
NOOPT = ""

# Дополнительные опции для линкера
LDOPTS = #-shared #если хочется использовать разделяемую библиотеку

# Если необходимо добавить CERNLIB, то лучше воспользоваться этим
# ключиком. Церновские библиотеки подшиваются в самом конце. По
# умалчанию подшиваются следущие библиотеки jetset74 mathlib graflib
# geant321 grafX11 packlib
CERNLIBRARY = ""

# Список библиотек, если вам не нравится стандартный набор, который
# расширяем по требованию. В любом случае необходимо раскомментировать
# CERNLIBRARY
CERNLIBS = geant jetset74 pawlib graflib grafX11 mathlib lapack3 blas

# Если определена переменная ONLYBINARY, то библиотека в пакете
# отсутствует и, соответственно, не собирается
#ONLYBINARY=""
# Местоположение исполнямых файлов.
BINDIR=./
#Раскомментируйте, если хочется собрать динамическую библиотеку
#LIB_SHARED = ""

# Дополнительные библиотеки. Вставляются во все пакеты.
#LIB_LOCAL=
#IB_LOCAL= `root-config --libs` -lMinuit -lpq -lcrypt -lbz2 -ldl -lg2c
LIB_LOCAL= `root-config --libs` -lstdc++ -lg2c -lpq -lcrypt -lbz2

# Определим, какие программы мы будем собирать.  Здесь следует
# указывать только используемые при работе пакеты, чтобы не засорять
# bin - все программки, которые пишутся дли примера и тестирования
# следует складывать в директорию example. Для сборки только одного из
# бинарников достаточно его указать при выполнении команды make,
# например: make templateTest
BINARIES =

# Укажем, из каких модулей этого пакета состоят перечисленные в
# BINARIES программы (эти модули не будут включены в библиотеку),
# какие библиотеки надо подключить при сборке и какой программой
# следует делать сборку (раскомментировать LD_MULTI).

# следующую строку лучше не трогать
#-----------------------------------
include $(WORKDIR)/KcReleaseTools/rules.mk
#-----------------------------------

#-----------------------------------
# Если хочется сделать что-то нестандартное, то не стесняйтесь
#-----------------------------------
# Свои цели следует определять здесь.
# Перед исполняемой командой следует вставить
# символ табуляции <Tab>.

.PHONY: example cleanobj reduced

REDUCEDLIBNAME := $(PACKAGE)-reduced

example:
	$(MAKE) -C examples

cleanobj:
	@echo "Removing fickle object files.."
	$(CMDPREFIX)rm -f $(TEMPDIR)/.depend $(TEMPDIR)/{AtcRec,AtcHit,Atc*Fitter}.o $(CMDSUFFIX)

reduced:
	@echo -e "\nMake reduced version of library.."
	@$(MAKE) ATC_NOFIT=1 ATC_NOROOT=1 LIBNAME=$(REDUCEDLIBNAME) cleanobj lib

#Если хотите сделать что-то перед сборкой
#Выполняется при исполнении make без параметров
PRE_MAKE: cleanobj


#Если хотите сделать что-то после полной сборки
#Выполняется при исполнении make без параметров
POST_MAKE: reduced

# Если хочется сделать что-то ещё - например сборка документации
#doc:
#	@echo "making docs"
#	@a2ps -X koi8-r Makefile -o Makefile.ps
#	@perldoc -t fixinc.pl > fixinc.txt
# DO NOT DELETE
